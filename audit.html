<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="favicon-48.png" />
  <title>Mackiavelli — Customized AI Audit</title>
  <meta name="description" content="Mackiavelli packages customized AI systems into guaranteed, productized solutions with hosting and support." />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              gold: '#CBA135',
              ivory: '#F8F7F4',
              black: '#0B0B0C',
              slate: '#1E1F22',
              blue: '#0074FF',
              red: '#D43F3A'
            }
          },
          fontFamily: { 
            cinzel: ['Cinzel', 'serif'],  // new font
          },
          boxShadow: {
            'elev': '0 10px 30px -10px rgba(0,0,0,0.35)'
          }
        }
      }
    }
  </script>

  <style>
    /* Bento grid aspect helpers */
    .bento { display:grid; gap:1rem; grid-template-columns: repeat(6, minmax(0,1fr)); }
    @media (min-width: 768px) { .bento { gap:1.25rem; } }
    html { scroll-behavior: smooth; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-brand-black text-brand-ivory antialiased">
  <!-- Sticky Navbar -->
<header class="sticky top-0 z-50 border-b border-neutral-800/60 bg-black/70 backdrop-blur">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <!-- Top bar: hamburger | centered logo | CTA -->
    <nav class="grid grid-cols-3 items-center h-14">
      <!-- Left: Hamburger -->
      <button id="menu-btn"
              class="justify-self-start p-2 text-brand-ivory relative z-50"
              aria-label="Open menu" aria-expanded="false" aria-controls="menu-panel">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Center: Logo -->
      <a href="index.html" class="justify-self-center font-cinzel text-lg font-bold tracking-wide text-[#CBA135]">
        Mackiavelli
      </a>

      <!-- Right: CTA -->
      <a href="discovery.html" class="justify-self-end bg-[#CBA135] text-black px-3 py-1.5 text-sm rounded-md font-semibold hover:opacity-90 md:px-4 md:py-2 md:text-base">
        Talk to sales
     </a>
    </nav>

    <!-- Slide-down menu -->
    <div id="menu-panel" class="hidden py-3 relative z-40">
      <div class="flex flex-wrap justify-center items-center gap-8 text-brand-ivory font-semibold">
        <!-- Features with dropdown -->
        <div class="relative">
          <button id="features-btn" class="flex items-center gap-1 hover:text-[#CBA135]" aria-expanded="false" aria-controls="features-menu">
            Features
            <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.18l3.71-3.95a.75.75 0 111.08 1.04l-4.25 4.52a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
            </svg>
          </button>
          <div id="features-menu" class="hidden absolute top-full 
            mt-2 z-50 left-0 translate-x-0     <!-- mobile: align to left of button -->
            md:left-0 md:translate-x-0         <!-- desktop: same anchor -->
            w-[min(92vw,18rem)] md:w-56        <!-- mobile: max ~92vw; desktop: fixed 14rem -->
            max-h-[60vh] overflow-y-auto       <!-- scroll if tall -->
            rounded-lg bg-neutral-900 border border-neutral-800 shadow-lg">
            <a href="booking.html" class="block px-4 py-2 text-sm hover:bg-neutral-800">Booking</a>
            <a href="chat.html"    class="block px-4 py-2 text-sm hover:bg-neutral-800">Chat</a>
            <a href="faqs.html"    class="block px-4 py-2 text-sm hover:bg-neutral-800">Custom</a>
            <a href="email.html"   class="block px-4 py-2 text-sm hover:bg-neutral-800">Email</a>
            <a href="faqs.html"    class="block px-4 py-2 text-sm hover:bg-neutral-800">FAQs</a>
            <a href="voice.html"   class="block px-4 py-2 text-sm hover:bg-neutral-800">Voice</a>
          </div>
        </div>

        <a href="index.html#how" class="hover:text-[#CBA135]">How it works</a>
        <a href="index.html#results" class="hover:text-[#CBA135]">Results</a>
      </div>
    </div>
  </div>
</header>

  <!-- ======= AUDIT FORM (VISIBLE) ======= -->
  <section id="ai-audit" class="py-16 bg-brand-black">
  <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
    <h1 class="text-center text-3xl font-bold text-brand-ivory">Free AI Efficiency Audit</h1>
    <p class="mt-2 text-center text-neutral-400">
      Answer a few questions so we can calculate time savings and recommend the best automations for your business.
    </p>

    <form id="ai-audit-form" class="mt-10 space-y-10 data-n8n="https://YOUR_N8N/webhook/ai-audit" data-success="#audit-confirmation" data-error="#audit-error"">
      <!-- 1) Business Overview -->
      <div class="rounded-2xl border border-neutral-800 bg-neutral-900/40 p-6">
        <h3 class="text-lg font-semibold text-brand-ivory">1) Business Overview</h3>
        <label class="mt-4 block text-sm text-neutral-400">Industry</label>
        <select name="industry" required
                class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50">
          <option value="" disabled selected>Select your industry</option>
          <option>Finance & Mortgage</option>
          <option>Property & Real Estate</option>
          <option>E-commerce & Retail</option>
          <option>Professional Services (Legal, Consulting, Accounting)</option>
          <option>Health & Wellness</option>
          <option>Education & Training</option>
          <option>Recruitment & HR</option>
          <option>Marketing & Creative Agencies</option>
          <option>Construction & Trades</option>
          <option>Hospitality & Events</option>
          <option>Technology & SaaS</option>
          <option>Logistics & Transport</option>
          <option>Nonprofit & Community</option>
          <option>Other</option>
        </select>

        <label class="mt-4 block text-sm text-neutral-400">Team size</label>
        <div class="mt-2 grid grid-cols-2 gap-3 sm:grid-cols-4">
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="team_size" value="1–5" class="text-[#CBA135] focus:ring-[#CBA135]" required> 1–5
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="team_size" value="6–20" class="text-[#CBA135] focus:ring-[#CBA135]"> 6–20
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="team_size" value="21–50" class="text-[#CBA135] focus:ring-[#CBA135]"> 21–50
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="team_size" value="50+" class="text-[#CBA135] focus:ring-[#CBA135]"> 50+
          </label>
        </div>

        <label class="mt-4 block text-sm text-neutral-400">Average monthly revenue (optional)</label>
        <input name="monthly_revenue" placeholder="e.g. £120,000"
               class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50" />

        <label class="mt-4 block text-sm text-neutral-400">Top goals for the next 6 months</label>
        <textarea name="goals" rows="3" placeholder="e.g. Generate more leads, reduce admin time, improve CX, cut costs…"
                  class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50"></textarea>
      </div>

      <!-- 2) Operations & Workflows -->
      <div class="rounded-2xl border border-neutral-800 bg-neutral-900/40 p-6">
        <h3 class="text-lg font-semibold text-brand-ivory">2) Operations & Workflows</h3>

        <label class="mt-4 block text-sm text-neutral-400">Which areas take the most time? (select all that apply)</label>
        <div class="mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2">
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Customer inquiries / FAQs" class="text-[#CBA135] focus:ring-[#CBA135]"> Customer inquiries / FAQs
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Scheduling & appointments" class="text-[#CBA135] focus:ring-[#CBA135]"> Scheduling & appointments
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Onboarding new clients" class="text-[#CBA135] focus:ring-[#CBA135]"> Onboarding new clients
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Document processing" class="text-[#CBA135] focus:ring-[#CBA135]"> Document processing
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Reporting / analytics" class="text-[#CBA135] focus:ring-[#CBA135]"> Reporting / analytics
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Internal communication" class="text-[#CBA135] focus:ring-[#CBA135]"> Internal communication
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="checkbox" name="time_areas" value="Marketing content creation" class="text-[#CBA135] focus:ring-[#CBA135]"> Marketing content creation
          </label>
          <div class="flex items-center gap-2">
            <input type="checkbox" id="time-other" class="text-[#CBA135] focus:ring-[#CBA135]">
            <span class="text-neutral-300">Other</span>
          </div>
          <input id="time-other-text" name="time_areas_other" placeholder="Describe other area…" class="hidden col-span-1 sm:col-span-2 rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50" />
        </div>

        <label class="mt-6 block text-sm text-neutral-400">
          Roughly how many hours per week are spent on these tasks?
        </label>
        <div class="mt-2">
        <select name="hours_per_week"
                class="w-full max-w-xs rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50">
        <option value="" disabled selected>Select range</option>
          <option>1–5 hours</option>
          <option>6–10 hours</option>
          <option>11–15 hours</option>
          <option>16–20 hours</option>
          <option>21–30 hours</option>
          <option>31–40 hours</option>
          <option>41–50 hours</option>
          <option>51–60 hours</option>
          <option>61–80 hours</option>
          <option>80+ hours</option>
        </select>
        </div>


        <label class="mt-6 block text-sm text-neutral-400">
          Which tools or systems do you currently use? (CRM, email, spreadsheets, forms, etc.)
        </label>
        <textarea name="current_tools" rows="2" placeholder="e.g. HubSpot, Google Workspace, Airtable, Slack, Calendly"
                  class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50"></textarea>

        <label class="mt-6 block text-sm text-neutral-400">How tech-savvy is your team?</label>
        <div class="mt-2 flex flex-wrap gap-6">
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="tech_savvy" value="Low" class="text-[#CBA135] focus:ring-[#CBA135]" required> Low
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="tech_savvy" value="Medium" class="text-[#CBA135] focus:ring-[#CBA135]"> Medium
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="tech_savvy" value="High" class="text-[#CBA135] focus:ring-[#CBA135]"> High
          </label>
        </div>
      </div>

      <!-- 3) Communication & Sales -->
      <div class="rounded-2xl border border-neutral-800 bg-neutral-900/40 p-6">
        <h3 class="text-lg font-semibold text-brand-ivory">3) Communication & Sales</h3>

        <label class="mt-4 block text-sm text-neutral-400">How do customers usually contact you?</label>
        <div class="mt-2 grid grid-cols-1 gap-3 sm:grid-cols-2">
          <label class="flex items-center gap-2 text-neutral-300"><input type="checkbox" name="contact_channels" value="Phone" class="text-[#CBA135] focus:ring-[#CBA135]"> Phone</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="checkbox" name="contact_channels" value="Email" class="text-[#CBA135] focus:ring-[#CBA135]"> Email</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="checkbox" name="contact_channels" value="Chat" class="text-[#CBA135] focus:ring-[#CBA135]"> Chat</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="checkbox" name="contact_channels" value="Website form" class="text-[#CBA135] focus:ring-[#CBA135]"> Website form</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="checkbox" name="contact_channels" value="Social media" class="text-[#CBA135] focus:ring-[#CBA135]"> Social media</label>
        </div>

        <label class="mt-6 block text-sm text-neutral-400">Do you already use any chatbots, automations, or AI tools?</label>
        <div class="mt-2 flex flex-wrap gap-6">
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="uses_ai_now" value="Yes" class="text-[#CBA135] focus:ring-[#CBA135]" required> Yes
          </label>
          <label class="flex items-center gap-2 text-neutral-300">
            <input type="radio" name="uses_ai_now" value="No" class="text-[#CBA135] focus:ring-[#CBA135]"> No
          </label>
        </div>

        <div id="tools_if_yes" class="mt-3 hidden">
          <label class="block text-sm text-neutral-400">If yes, which?</label>
          <input name="ai_tools_list" placeholder="e.g. Zapier, Voiceflow, n8n, OpenAI, ManyChat…"
                 class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50" />
        </div>

        <label class="mt-6 block text-sm text-neutral-400">How do you currently qualify or onboard new leads?</label>
        <input name="lead_qualification" placeholder="e.g. Manual, spreadsheet, CRM workflow"
               class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50" />

        <label class="mt-6 block text-sm text-neutral-400">How often do you lose leads due to slow replies/admin delays?</label>
        <div class="mt-2 flex flex-wrap gap-6">
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="lost_leads_frequency" value="Rarely" class="text-[#CBA135] focus:ring-[#CBA135]" required> Rarely</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="lost_leads_frequency" value="Sometimes" class="text-[#CBA135] focus:ring-[#CBA135]"> Sometimes</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="lost_leads_frequency" value="Often" class="text-[#CBA135] focus:ring-[#CBA135]"> Often</label>
        </div>
      </div>

      <!-- 4) Data & Tools -->
      <div class="rounded-2xl border border-neutral-800 bg-neutral-900/40 p-6">
        <h3 class="text-lg font-semibold text-brand-ivory">4) Data & Tools</h3>

        <label class="mt-4 block text-sm text-neutral-400">Which platforms does your business rely on daily?</label>
        <textarea name="daily_platforms" rows="2" placeholder="e.g. Google Workspace, HubSpot, Notion, Zapier, Voiceflow, n8n, Monday.com…"
                  class="mt-1 w-full rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50"></textarea>
      </div>

      <!-- 5) Results & Output Preferences -->
      <div class="rounded-2xl border border-neutral-800 bg-neutral-900/40 p-6">
        <h3 class="text-lg font-semibold text-brand-ivory">5) Results & Output Preferences</h3>

        <label class="mt-4 block text-sm text-neutral-400">What’s most important right now? (choose one)</label>
        <div class="mt-2 grid grid-cols-1 gap-3 sm:grid-cols-2">
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="primary_priority" value="Reducing manual workload" class="text-[#CBA135] focus:ring-[#CBA135]" required> Reducing manual workload</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="primary_priority" value="Increasing lead conversion" class="text-[#CBA135] focus:ring-[#CBA135]"> Increasing lead conversion</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="primary_priority" value="Improving customer experience" class="text-[#CBA135] focus:ring-[#CBA135]"> Improving customer experience</label>
          <label class="flex items-center gap-2 text-neutral-300"><input type="radio" name="primary_priority" value="Reducing costs" class="text-[#CBA135] focus:ring-[#CBA135]"> Reducing costs</label>
          <label class="flex items-center gap-2 text-neutral-300 sm:col-span-2"><input type="radio" name="primary_priority" value="Building new revenue streams" class="text-[#CBA135] focus:ring-[#CBA135]"> Building new revenue streams</label>
        </div>

        <label class="mt-6 block text-sm text-neutral-400">
        Roughly how many hours per week are spent on these tasks?
        </label>
        <div class="mt-2">
         <select name="hours_per_week"
           class="w-full max-w-xs rounded-lg border border-neutral-800 bg-neutral-900/60 p-3 text-sm text-brand-ivory focus:ring-2 focus:ring-[#CBA135]/50">
           <option value="" disabled selected>Select hours</option>
           <option>0–5 hours</option>
           <option>6–10 hours</option>
           <option>11–20 hours</option>
           <option>21–40 hours</option>
           <option>40+ hours</option>
         </select>
      </div>
      </div>

      <!-- contact details-->
      <div class="rounded-2xl border border-neutral-800 bg-neutral-900/40 p-6">
        <h3 class="text-lg font-semibold text-brand-ivory">6) Contact Details</h3>
        <div class="mt-4 grid gap-4 sm:grid-cols-2">
          <div>
            <label class="block text-sm text-neutral-300 mb-1" for="fullName">Full Name</label>
            <input id="fullName" name="fullName" required
                   class="w-full rounded-lg border border-neutral-800 bg-brand-black px-3 py-2 outline-none focus:border-[#CBA135]">
          </div>
          <div>
            <label class="block text-sm text-neutral-300 mb-1" for="company">Company Name</label>
            <input id="company" name="company" required
                   class="w-full rounded-lg border border-neutral-800 bg-brand-black px-3 py-2 outline-none focus:border-[#CBA135]">
          </div>
          <div>
            <label class="block text-sm text-neutral-300 mb-1" for="email">Work Email</label>
            <input id="email" name="email" type="email" required
                   class="w-full rounded-lg border border-neutral-800 bg-brand-black px-3 py-2 outline-none focus:border-[#CBA135]">
          </div>
          <div>
            <label class="block text-sm text-neutral-300 mb-1" for="phone">Phone (optional)</label>
            <input id="phone" name="phone" type="tel"
                   class="w-full rounded-lg border border-neutral-800 bg-brand-black px-3 py-2 outline-none focus:border-[#CBA135]">
          </div>
        </div>
      </div>

      <!-- Submit -->
      <button type="submit" class="rounded-md bg-[#CBA135] px-4 py-2 font-semibold text-black hover:opacity-90 w-full">
        Get My Your Free AI Audit
      </button>

      <!-- Honeypot -->
      <input type="text" name="company_name" class="hidden" autocomplete="off" tabindex="-1" aria-hidden="true"">
    </form>

     <!-- Add an error message target -->
     <p id="audit-error" class="hidden mt-4 text-center text-red-400">
     Sorry—there was a problem submitting your audit. Please try again.
     </p>

    <!-- Confirmation -->
    <div id="audit-confirmation" class="hidden mt-6 text-center text-[#CBA135] font-medium">
      ✅ Thank you! Your AI Efficiency Audit request has been submitted.<br>
      You’ll receive your personalized report within 24 hours.
    </div>
  </section>

  <!-- Scripts -->
  <script>
    const otherChk = document.getElementById('challengeOtherChk');
    const otherInput = document.getElementById('challengeOther');
    const auditFormElement = document.getElementById('aiAuditForm');
    const confirmation = document.getElementById('audit-confirmation');

    function toggleOther() {
      const on = otherChk.checked;
      otherInput.disabled = !on;
      otherInput.classList.toggle('opacity-50', !on);
      if (!on) otherInput.value = '';
      if (on) otherInput.focus();
    }
    otherChk?.addEventListener('change', toggleOther);

    // Submit: show success message (no backend yet)
    auditFormElement?.addEventListener('submit', (e) => {
      e.preventDefault();
      // simple honeypot check
      const hp = auditFormElement.querySelector('input[name="website"]');
      if (hp && hp.value.trim() !== '') return;

      auditFormElement.classList.add('hidden');
      confirmation.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // initialize "Other" state (handles iOS back/forward cache)
    toggleOther();
  </script>
   <!-- JS for toggling -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const menuBtn    = document.getElementById('menu-btn');
  const menuPanel  = document.getElementById('menu-panel');
  const featuresBtn = document.getElementById('features-btn');
  const featuresMenu = document.getElementById('features-menu');

  if (menuBtn && menuPanel) {
    menuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      menuPanel.classList.toggle('hidden');
      featuresMenu?.classList.add('hidden');
    });
  }

  if (featuresBtn && featuresMenu) {
    featuresBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      featuresMenu.classList.toggle('hidden');
    });
  }

  document.addEventListener('click', (e) => {
    if (!menuPanel?.classList.contains('hidden') &&
        !menuPanel.contains(e.target) &&
        !menuBtn.contains(e.target)) {
      menuPanel.classList.add('hidden');
      featuresMenu?.classList.add('hidden');
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      menuPanel?.classList.add('hidden');
      featuresMenu?.classList.add('hidden');
    }
  });
});
</script>

  <script>
(function () {
  const forms = document.querySelectorAll("form[data-n8n]");
  if (!forms.length) return;

  const getUTMs = () => {
    const params = new URLSearchParams(location.search);
    const utm = {};
    ["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(k => {
      if (params.get(k)) utm[k] = params.get(k);
    });
    return utm;
  };

  const serializeForm = (form) => {
    const data = {};
    const fd = new FormData(form);

    for (const [key, value] of fd.entries()) {
      // handle multiple checkboxes with same name → array
      if (data[key] !== undefined) {
        if (Array.isArray(data[key])) data[key].push(value);
        else data[key] = [data[key], value];
      } else {
        data[key] = value.trim ? value.trim() : value;
      }
    }

    // add metadata
    data._meta = {
      page: location.href,
      referrer: document.referrer || null,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      userAgent: navigator.userAgent,
      ts: new Date().toISOString(),
      utm: getUTMs(),
      source: form.getAttribute("id") || "form"
    };

    return data;
  };

  const show = (sel, bool) => {
    const el = sel && document.querySelector(sel);
    if (!el) return;
    el.classList.toggle("hidden", !bool);
  };

  const validate = (form, payload) => {
    // honeypot
    if (payload.company_name) return "Bot detected";
    // simple email check if present
    const emailField = form.querySelector('input[type="email"]');
    if (emailField && !/^\S+@\S+\.\S+$/.test(emailField.value)) return "Enter a valid email.";
    // optional: require slot if slot field exists
    const slotField = form.querySelector('[name="slot_start_iso"]');
    if (slotField && !slotField.value) return "Please choose a time slot.";
    return null;
  };

  forms.forEach(form => {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      show(form.dataset.success, false);
      show(form.dataset.error,   false);

      const payload = serializeForm(form);
      const err = validate(form, payload);
      if (err) { show(form.dataset.error, true); return; }

      const endpoint = form.dataset.n8n;
      const btn = form.querySelector('[type="submit"]');
      const originalText = btn?.textContent;

      try {
        if (btn) { btn.disabled = true; btn.textContent = "Submitting..."; }

        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) throw new Error("Bad response");
        show(form.dataset.success, true);
        form.reset();

      } catch (e) {
        console.error(e);
        show(form.dataset.error, true);
      } finally {
        if (btn) { btn.disabled = false; btn.textContent = originalText; }
      }
    });
  });
})();
</script>
</body>
</html>
